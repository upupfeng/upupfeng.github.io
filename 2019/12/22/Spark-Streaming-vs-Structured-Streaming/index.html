<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!--Description-->
    
        <meta name="description" content="简介Spark StreamingSpark Streaming是spark最初的流处理框架，使用了微批的形式来进行流处理。
提供了基于RDDs的Dstream API，每个时间间隔内的数据为一个RDD，源源不断对RDD进行处理来实现流计算
Structured StreamingSpark 2.X">
    

    <!--Author-->
    
        <meta name="author" content="upupfeng">
    

    <!--Open Graph Title-->
    
        <meta property="og:title" content="Spark Streaming vs. Structured Streaming"/>
    

    <!--Open Graph Description-->
    

    <!--Open Graph Site Name-->
    <meta property="og:site_name" content="upupfeng&#39;s blog"/>

    <!--Type page-->
    
        <meta property="og:type" content="article" />
    

    <!--Page Cover-->
    

    <meta name="twitter:card" content="summary" />
    

    <!-- Title -->
    
    <title>Spark Streaming vs. Structured Streaming - upupfeng&#39;s blog</title>

    <!-- Tachyons Core CSS -->
    <link rel="stylesheet" href="https://unpkg.com/tachyons/css/tachyons.min.css">

    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="//oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="//oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/style.css">

    <!-- Google Analytics -->
    


</head>


<body>

<!-- Main Content -->
<!-- Banner -->
<!-- Banner -->
<div class="w-100 bg-1 ph5-ns ph3 text-light">
    
    <nav class="db dt-l w-100 mw8 center border-box pv3">
        <a class="db dtc-l v-mid link dim w-100 w-25-l tc tl-l mb2 mb0-l white" href="/" title="upupfeng's blog">
            <img src="/assets/face_nobg.png" class="dib h3" alt="upupfeng's blog">
        </a>
        <div class="db dtc-l v-mid w-100 w-75-l tc tr-l">
            
                <a class="link dim f6 f5-l dib mr3 mr4-l white" 
                    href="/" 
                    title="主页">
                    主页
                </a>
            
                <a class="link dim f6 f5-l dib mr3 mr4-l white" 
                    href="/categories" 
                    title="分类">
                    分类
                </a>
            
                <a class="link dim f6 f5-l dib mr3 mr4-l white" 
                    href="/archives" 
                    title="归档">
                    归档
                </a>
            
                <a class="link dim f6 f5-l dib mr3 mr4-l white" 
                    href="/about.html" 
                    title="关于我">
                    关于我
                </a>
            
        </div>
    </nav>

    <!-- Title -->
    <div class="w-100 mw8 center vh-40 dt">
        <div class="dtc v-mid white">
            <h1 class="f1-l f2-m tc tc-m tl-ns">Spark Streaming vs. Structured Streaming</h1>
            <p class="f4 fw3 pab-100px tc tc-m tl-ns">2019-12-22</p>
        </div>
    </div>

    <!-- Icon -->
    <div class="relative w-100 mw8 center white dn dn-m db-ns">
        <i class="header-icon fa fa fa-battery-full"></i>
    </div>
</div>

<!-- Content -->
<div class="w-100 ph2 ph4-m ph5-l mv5 mv6-l">
    <div class="content">
        <div class="mw8 center">
            <div class="cf">
                <div class="fl w-100 w-70-l mw7 left fw3 lh-copy pr4-ns pr0-m post-content">
                    <!-- Tags Vertical -->
                    

                    <!-- Main Post Content -->
                    <h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><h3 id="Spark-Streaming"><a href="#Spark-Streaming" class="headerlink" title="Spark Streaming"></a>Spark Streaming</h3><p>Spark Streaming是spark最初的流处理框架，使用了微批的形式来进行流处理。</p>
<p>提供了基于RDDs的Dstream API，每个时间间隔内的数据为一个RDD，源源不断对RDD进行处理来实现流计算</p>
<h3 id="Structured-Streaming"><a href="#Structured-Streaming" class="headerlink" title="Structured Streaming"></a>Structured Streaming</h3><p>Spark 2.X出来的流框架，采用了无界表的概念，流数据相当于往一个表上不断追加行。</p>
<p>基于Spark SQL引擎实现，可以使用大多数Spark SQL的function</p>
<h2 id="区别"><a href="#区别" class="headerlink" title="区别"></a>区别</h2><h3 id="1-流模型"><a href="#1-流模型" class="headerlink" title="1. 流模型"></a>1. 流模型</h3><h4 id="Spark-Streaming-1"><a href="#Spark-Streaming-1" class="headerlink" title="Spark Streaming"></a>Spark Streaming</h4><p><img src="https://img-blog.csdnimg.cn/20191222111758467.png" alt="在这里插入图片描述"><br>Spark Streaming采用<strong>微批</strong>的处理方法。每一个批处理间隔的为一个批，也就是一个RDD，我们对RDD进行操作就可以源源不断的接收、处理数据。</p>
<p>spark streaming微批终是批</p>
<h4 id="Structured-Streaming-1"><a href="#Structured-Streaming-1" class="headerlink" title="Structured Streaming"></a>Structured Streaming</h4><p><img src="https://img-blog.csdnimg.cn/20191222111818637.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2lmZW5nZ2VnZQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>Structured Streaming is to treat a live data stream as a table that is being continuously appended</p>
<p>Structured Streaming将实时数据当做<strong>被连续追加的表</strong>。流上的每一条数据都类似于将一行新数据添加到表中。</p>
<p><img src="https://img-blog.csdnimg.cn/20191222111843202.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2lmZW5nZ2VnZQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>以上图为例，每隔1秒从输入源获取数据到Input Table，并触发Query计算，然后将结果写入Result Table，之后根据指定的Output模式进行写出。</p>
<p>上面的1秒是指定的触发间隔（trigger interval），如果不指定的话，先前数据的处理完成后，系统将立即检查是否有新数据。</p>
<p>需要注意的是，Spark Streaming本身设计就是一批批的以批处理间隔划分RDD；而Structured Streaming中并没有提出批的概念，Structured Streaming按照每个Trigger Interval接收数据到Input Table，将数据处理后再追加到无边界的Result Table中，想要何种方式输出结果取决于指定的模式。所以，虽说Structured Streaming也有类似于Spark Streaming的Interval，其本质概念是不一样的。Structured Streaming更像流模式。</p>
<h3 id="2-RDD-vs-DataFrame、DataSet"><a href="#2-RDD-vs-DataFrame、DataSet" class="headerlink" title="2. RDD vs. DataFrame、DataSet"></a>2. RDD vs. DataFrame、DataSet</h3><p>Spark Streaming中的DStream编程接口是RDD，我们需要对RDD进行处理，处理起来较为费劲且不美观。</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">stream.foreachRDD(rdd =&gt; &#123;</span><br><span class="line">    balabala(rdd)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>Structured Streaming使用DataFrame、DataSet的编程接口，处理数据时可以使用Spark SQL中提供的方法，数据的转换和输出会变得更加简单。</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">spark</span><br><span class="line">    .readStream</span><br><span class="line">    .format(<span class="string">"kafka"</span>)</span><br><span class="line">    .option(<span class="string">"kafka.bootstrap.servers"</span>, <span class="string">"hadoop01:9092"</span>)</span><br><span class="line">    .option(<span class="string">"subscribe"</span>, <span class="string">"order_data"</span>)</span><br><span class="line">    .load()</span><br><span class="line">    .select($<span class="string">"value"</span>.cast(<span class="string">"string"</span>))</span><br><span class="line">    .as[<span class="type">String</span>]</span><br><span class="line">    .writeStream</span><br><span class="line">    .outputMode(<span class="string">"complete"</span>)</span><br><span class="line">    .format(<span class="string">"console"</span>)</span><br></pre></td></tr></table></figure>

<h3 id="3-Process-Time-vs-Event-Time"><a href="#3-Process-Time-vs-Event-Time" class="headerlink" title="3. Process Time vs. Event Time"></a>3. Process Time vs. Event Time</h3><p>Process Time：流处理引擎接收到数据的时间</p>
<p>Event Time：时间真正发生的时间</p>
<p>Spark Streaming中由于其微批的概念，会将一段时间内接收的数据放入一个批内，进而对数据进行处理。划分批的时间是Process Time，而不是Event Time，Spark Streaming没有提供对Event Time的支持。</p>
<p>Structured Streaming提供了基于事件时间处理数据的功能，如果数据包含事件的时间戳，就可以基于事件时间进行处理。</p>
<p>这里以<strong>窗口计数</strong>为例说明一下区别：</p>
<blockquote>
<p>我们这里以10分钟为窗口间隔，5分钟为滑动间隔，每隔5分钟统计过去10分钟网站的pv</p>
</blockquote>
<p>假设有一些迟到的点击数据，其本身事件时间是12:01，被spark接收到的时间是12:11；在spark streaming的统计中，会毫不犹豫的将它算作是12:05-12:15这个范围内的pv，这显然是不恰当的；在structured streaming中，可以使用事件时间将它划分到12:00-12:10的范围内，这才是我们想要的效果。</p>
<h3 id="4-可靠性保障"><a href="#4-可靠性保障" class="headerlink" title="4. 可靠性保障"></a>4. 可靠性保障</h3><p>两者在可靠性保证方面都是使用了checkpoint机制。</p>
<p>checkpoint通过设置检查点，将数据保存到文件系统，在出现出故障的时候进行数据恢复。</p>
<p>在spark streaming中，如果我们需要修改流程序的代码，在修改代码重新提交任务时，是不能从checkpoint中恢复数据的（程序就跑不起来），是因为spark不认识修改后的程序了。</p>
<p>在structured streaming中，对于指定的代码修改操作，是不影响修改后从checkpoint中恢复数据的。具体可参见<a href="https://spark.apache.org/docs/latest/structured-streaming-programming-guide.html#recovery-semantics-after-changes-in-a-streaming-query" target="_blank" rel="noopener">文档</a>。</p>
<h3 id="5-sink"><a href="#5-sink" class="headerlink" title="5. sink"></a>5. sink</h3><p>二者的输出数据（写入下游）的方式有很大的不同。</p>
<p>spark streaming中提供了<code>foreachRDD()</code>方法，通过自己编程实现将每个批的数据写出。</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">stream.foreachRDD(rdd =&gt; &#123;</span><br><span class="line">    save(rdd)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>structured streaming自身提供了一些sink(Console Sink、File Sink、Kafka Sink等)，只要通过option配置就可以使用；对于需要自定义的Sink，提供了ForeachWriter的编程接口，实现相关方法就可以完成。</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// console sink</span></span><br><span class="line"><span class="keyword">val</span> query = res</span><br><span class="line">    .writeStream</span><br><span class="line">    .outputMode(<span class="string">"append"</span>)</span><br><span class="line">    .format(<span class="string">"console"</span>)</span><br><span class="line">    .start()</span><br></pre></td></tr></table></figure>

<h3 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h3><p>总体来说，structured streaming有更简洁的API、更完善的流功能、更适用于流处理。而spark streaming，更适用于与偏批处理的场景。</p>
<p>在流处理引擎方面，flink最近也很火，值得我们去学习一番。</p>
<h3 id="reference"><a href="#reference" class="headerlink" title="reference"></a>reference</h3><p><a href="https://blog.knoldus.com/spark-streaming-vs-structured-streaming/" target="_blank" rel="noopener">https://blog.knoldus.com/spark-streaming-vs-structured-streaming/</a></p>
<p><a href="https://dzone.com/articles/spark-streaming-vs-structured-streaming" target="_blank" rel="noopener">https://dzone.com/articles/spark-streaming-vs-structured-streaming</a></p>
<p><a href="https://spark.apache.org/docs/2.0.2/streaming-programming-guide.html" target="_blank" rel="noopener">https://spark.apache.org/docs/2.0.2/streaming-programming-guide.html</a></p>
<p><a href="https://spark.apache.org/docs/latest/structured-streaming-programming-guide.html" target="_blank" rel="noopener">https://spark.apache.org/docs/latest/structured-streaming-programming-guide.html</a></p>
<br>

<p><font color='red'>以上为个人理解，如有不对的地方，欢迎交流指正。</font></p>
<p><img src="https://img-blog.csdnimg.cn/20191222120816758.jpg" alt="在这里插入图片描述"><br>个人公众号：码农峰，推送最新行业资讯，每周发布原创技术文章，欢迎大家关注。</p>

                    
                    <!-- Tags Bottom -->
                    

                    <!-- Comments -->
                    



                </div>
                <div class="fl w-100 w-30-l center fw3 lh-copy pl4-ns tl black-50">
                    
                    <hr class="dn-l mw4 black-50 mt5" />
                    
                    <!-- Widget 1: About -->
                    <div class="mt5 mt0-l">
    <article class="dt db-l mw8 mw8-m mw5-ns center ml0-l bg-white mv3">
        <div class="dn dtc-m db-l v-mid tc pr4 pr0-l" style="min-width: 6rem;">
            <img src="https://avatar.csdnimg.cn/E/7/E/1_ifenggege.jpg" class="mb4-l br-100 h3 w3 h4-l w4-l dib" title="upupfeng">
        </div>
        <div class="dtc db-l v-mid lh-copy measure center f6 black-50 tj">
            贵有恒，要坚持。
        </div>
    </article>
</div>

                    <hr class="dn-l mw4 black-50 mt5" />
                    
                    <!-- Widget 2: Categories -->
                    
                        <div class="mt5 tc tl-l">
    <h3>分类</h3>
    
        <p>
            <a href="/categories/spark/">spark</a>
        </p>
    
</div>


                        <hr class="dn-l mw4 black-50 mt5" />
                    

                    <!-- Widget 3: Recent Posts -->
                    <div class="mt5 tc tl-l">
    <h3>近期文章</h3>
    
        <p>
            <a href="/2019/12/22/Spark-Streaming-vs-Structured-Streaming/">Spark Streaming vs. Structured Streaming</a>
        </p>
    
        <p>
            <a href="/2019/11/23/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93-%E6%95%B0%E6%8D%AE%E5%90%8C%E6%AD%A5/">数据仓库-数据同步</a>
        </p>
    
        <p>
            <a href="/2019/11/23/%E4%B8%80%E6%96%87%E4%BA%86%E8%A7%A3%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/">一文了解数据仓库</a>
        </p>
    
        <p>
            <a href="/2019/11/23/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93%E5%8E%86%E5%8F%B2%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8-%E6%8B%89%E9%93%BE%E8%A1%A8/">数据仓库历史数据存储 - 拉链表</a>
        </p>
    
        <p>
            <a href="/2019/11/23/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E7%BD%91%E7%AB%99%E6%90%AD%E5%BB%BA/">个人博客网站搭建</a>
        </p>
    
</div>
                </div>
            </div>
        </div>
    </div>
</div>


<!-- Footer -->
<div class="bg-1 ph2 ph5-ns pv5">
        <div class="mv8">
            <div class="center tc">
                
                    <div class="dib mh3">
                        <a class="f3 f2-ns white dim" href="https://github.com/upupfeng" target="_blank">
                            <i class="fa fa-github"></i>
                        </a>
                    </div>
                
            </div>
            <div class="f6 f5-ns center tc white pt5 fw3">
                upupfeng
            </div>
        </div>
    </div>

<!-- After Footer -->
<!-- Disqus Comments -->



</body>

</html>